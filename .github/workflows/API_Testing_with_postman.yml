name: Automated API tests using Newman

on: push

jobs:
  automated-api-tests:
    runs-on: ubuntu-latest
    steps:
      # Step 1: Check out the repository
      - name: Checkout code
        uses: actions/checkout@v4

      # Step 2: Set up Node.js (Newman requires Node.js)
      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '16'  # Specify the Node.js version

      # Step 3: Install Newman
      - name: Install Newman
        run: npm install -g newman

      # Step 4: Run the Postman collection with iteration count
      - name: Run Postman Collection
        run: |
         for file in DataFiles/*.json; do
            echo "Running tests with data file: $file"
          newman run PetStoreAPI_Tests.postman_collection.json \
          --iteration-count 3 \
          --iteration-data "$file"
          --reporters cli,html \
          --reporter-html-export JenkinsReport/newman-report.html
